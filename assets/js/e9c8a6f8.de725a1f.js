"use strict";(self.webpackChunknblocks_docs=self.webpackChunknblocks_docs||[]).push([[6015],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(n),h=o,k=p["".concat(s,".").concat(h)]||p[h]||d[h]||l;return n?a.createElement(k,r(r({ref:t},u),{},{components:n})):a.createElement(k,r({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=n.length,r=new Array(l);r[0]=p;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var c=2;c<l;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),o=n(6010);const l="tabItem_Ymn6";function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(l,r),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>h});var a=n(7462),o=n(7294),l=n(6010),r=n(2389),i=n(7392),s=n(7094),c=n(2466);const u="tabList__CuJ",d="tabItem_LNqP";function p(e){const{lazy:t,block:n,defaultValue:r,values:p,groupId:h,className:k}=e,m=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=p??m.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),g=(0,i.l)(b,((e,t)=>e.value===t.value));if(g.length>0)throw new Error(`Docusaurus error: Duplicate values "${g.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const f=null===r?r:r??m.find((e=>e.props.default))?.props.value??m[0].props.value;if(null!==f&&!b.some((e=>e.value===f)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${f}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:v}=(0,s.U)(),[w,N]=(0,o.useState)(f),T=[],{blockElementScrollPositionUntilNextRender:C}=(0,c.o5)();if(null!=h){const e=y[h];null!=e&&e!==w&&b.some((t=>t.value===e))&&N(e)}const P=e=>{const t=e.currentTarget,n=T.indexOf(t),a=b[n].value;a!==w&&(C(t),N(a),null!=h&&v(h,String(a)))},_=e=>{let t=null;switch(e.key){case"Enter":P(e);break;case"ArrowRight":{const n=T.indexOf(e.currentTarget)+1;t=T[n]??T[0];break}case"ArrowLeft":{const n=T.indexOf(e.currentTarget)-1;t=T[n]??T[T.length-1];break}}t?.focus()};return o.createElement("div",{className:(0,l.Z)("tabs-container",u)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":n},k)},b.map((e=>{let{value:t,label:n,attributes:r}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>T.push(e),onKeyDown:_,onClick:P},r,{className:(0,l.Z)("tabs__item",d,r?.className,{"tabs__item--active":w===t})}),n??t)}))),t?(0,o.cloneElement)(m.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},m.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function h(e){const t=(0,r.Z)();return o.createElement(p,(0,a.Z)({key:String(t)},e))}},6194:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var a=n(7462),o=(n(7294),n(3905)),l=n(5488),r=n(5162);const i={sidebar_position:2,sidebar_label:"Quickstart Cloud Login",description:"Quickstart Cloud Login | Nblocks Documentation"},s="Quickstart Cloud Login",c={unversionedId:"essentials/quickstart-cloud-views",id:"essentials/quickstart-cloud-views",title:"Quickstart Cloud Login",description:"Quickstart Cloud Login | Nblocks Documentation",source:"@site/docs/essentials/quickstart-cloud-views.mdx",sourceDirName:"essentials",slug:"/essentials/quickstart-cloud-views",permalink:"/nblocks-docs/docs/essentials/quickstart-cloud-views",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/essentials/quickstart-cloud-views.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Quickstart Cloud Login",description:"Quickstart Cloud Login | Nblocks Documentation"},sidebar:"tutorialSidebar",previous:{title:"Quickstart (10 min)",permalink:"/nblocks-docs/docs/essentials/quickstart"},next:{title:"Getting payment ready (10 min)",permalink:"/nblocks-docs/docs/essentials/payment-ready"}},u={},d=[{value:"Overview",id:"overview",level:2},{value:"Create a Nblocks app",id:"create-a-nblocks-app",level:2},{value:"Integrating with Cloud Login",id:"integrating-with-cloud-login",level:2},{value:"Step 1. Redirect the user to cloud login",id:"step-1-redirect-the-user-to-cloud-login",level:3},{value:"Step 2. Receive the user back and obtain the tokens.",id:"step-2-receive-the-user-back-and-obtain-the-tokens",level:3},{value:"Step 3. Decode the tokens into auth and profile information",id:"step-3-decode-the-tokens-into-auth-and-profile-information",level:3},{value:"Testing login",id:"testing-login",level:2},{value:"Step 1. Start by redirecting the user to the cloud login url.",id:"step-1-start-by-redirecting-the-user-to-the-cloud-login-url",level:3},{value:"Step 2. Complete login",id:"step-2-complete-login",level:3}],p={toc:d};function h(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"quickstart-cloud-login"},"Quickstart Cloud Login"),(0,o.kt)("p",null,"Integrate with Nblocks Cloud Login in any stack and have your users authenticate in no time!"),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"The following guide will get you up and running as quickly as possible by covering the following 3 steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create a Nblocks app and get hold of your App id."),(0,o.kt)("li",{parentName:"ol"},"Integrate Nblocks login flow into your project."),(0,o.kt)("li",{parentName:"ol"},"Testing the login flow")),(0,o.kt)("p",null,"Lets go! \ud83d\ude80"),(0,o.kt)("h2",{id:"create-a-nblocks-app"},"Create a Nblocks app"),(0,o.kt)("p",null,"If you haven't already, create a Nblocks app. This is super simple to do with our terminal tools where you'll be guided throught the process."),(0,o.kt)(l.Z,{mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"npm",label:"Npm",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npx @nebulr-group/nblocks-cli create-app\n")),(0,o.kt)("p",null,"The tool will place an ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file containing your Nblocks Api key and download a copy of your app profile into a file ",(0,o.kt)("inlineCode",{parentName:"p"},"app-configuration.json"),"."))),(0,o.kt)("h2",{id:"integrating-with-cloud-login"},"Integrating with Cloud Login"),(0,o.kt)("p",null,"There will be three steps in this integration. We're going to go through each one of them and show examples for different software stacks.\nThe main idea will not be different no matter what stack your building on."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Redirect the user to cloud login."),(0,o.kt)("li",{parentName:"ol"},"After completed login, the user is redirected back to your app with a code which should be exchanged for tokens."),(0,o.kt)("li",{parentName:"ol"},"Decode the tokens into useful auth and profile information.")),(0,o.kt)("h3",{id:"step-1-redirect-the-user-to-cloud-login"},"Step 1. Redirect the user to cloud login"),(0,o.kt)("p",null,"To start the login process you need to redirect the user to the cloud login url. This url is easy to construct."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Redirect the user to this url:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"https://auth-stage.nblocks.cloud/url/login/APP_ID\n")),(0,o.kt)("admonition",{title:"What APP_ID?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"APP_ID")," is your Nblocks app id. You can get this from your ",(0,o.kt)("inlineCode",{parentName:"p"},"app-configuration.json")," file.")),(0,o.kt)("p",null,"Preferrably you would put this redirect in the beginning of your app flow to make sure users are logged in. Below are some examples for different stacks."),(0,o.kt)(l.Z,{mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"sdk",label:"SDK",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// Get the url and redirect\nconst url = new NblocksPublicClient(APP_ID).auth.getLoginUrl();\nwindow.location.href = url;\n"))),(0,o.kt)(r.Z,{value:"js",label:"JS",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'window.location.href = "https://auth-stage.nblocks.cloud/url/login/APP_ID";\n')))),(0,o.kt)("h3",{id:"step-2-receive-the-user-back-and-obtain-the-tokens"},"Step 2. Receive the user back and obtain the tokens."),(0,o.kt)("p",null,"When the user completes login the user will be redirected back to your app with the url",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/auth/oauth-callback?code=eyJh....")),(0,o.kt)("p",null,"You need to obtain this code from the url search params and exchange it for tokens."),(0,o.kt)("p",null,"This can be done by exposing a new route ",(0,o.kt)("inlineCode",{parentName:"p"},"/auth/oauth-callback")," where you load a component or intercept the incoming call in your app.\nIt all depends on what stack your using and how your building."),(0,o.kt)("p",null,"Once the code has been obtained; call the ",(0,o.kt)("em",{parentName:"p"},"token")," endpoint with the code in the body to retrieve the tokens."),(0,o.kt)(l.Z,{mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"rest",label:"REST",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"POST https://auth-stage.nblocks.cloud/token/code/APP_ID"),(0,o.kt)("br",{parentName:"p"}),"\n","Body ",(0,o.kt)("inlineCode",{parentName:"p"},'{"code": "eyJh...."}')),(0,o.kt)("p",null,"The endpoint will return the tokens in JSON format."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "access_token": "eyJhbGciOiJQ...",\n  "refresh_token": "eyJhbGciOiJQ...",\n  "token_type": "Bearer",\n  "expires_in": 3600,\n  "id_token": "eyJhbGciOiJQ...",\n}\n'))),(0,o.kt)(r.Z,{value:"sdk",label:"SDK",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const code = (new URL(window.location.href)).searchParams.get('code');\nconst tokens = new NblocksPublicClient(APP_ID).auth.getTokens(code);\n"))),(0,o.kt)(r.Z,{value:"js",label:"JS",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const code = (new URL(window.location.href)).searchParams.get(\'code\');\nconst tokens = await fetch("https://auth-stage.nblocks.cloud/token/code/APP_ID",\n  {\n    method: "POST",\n    headers: {\n      "Content-Type": "application/json",\n    },\n    body: JSON.stringify({\n      code,\n    }),\n  }\n).then(res => res.json());\n')))),(0,o.kt)("h3",{id:"step-3-decode-the-tokens-into-auth-and-profile-information"},"Step 3. Decode the tokens into auth and profile information"),(0,o.kt)("p",null,"You need to decode the tokens from their compact form into readable JSON."),(0,o.kt)("p",null,"These tokens are ",(0,o.kt)("a",{parentName:"p",href:"https://jwt.io"},"JWT")," tokens, provided in a compact form, all according to the ",(0,o.kt)("a",{parentName:"p",href:"https://www.oauth.com"},"OAuth 2.0 / OpenID standard"),".\nThat means there are plenty of libraries for many software stacks to decode them into readable JSON. Here's a extensive list of tools for most software stacks ",(0,o.kt)("a",{parentName:"p",href:"https://jwt.io/libraries"},"https://jwt.io/libraries"),"."),(0,o.kt)(l.Z,{mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"sdk",label:"SDK",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// Decode and verifies the tokens, everything comes bundled\nconst authContext = new NblocksPublicClient(APP_ID).auth.context.getAuthContext(access_token);\nconst profile = new NblocksPublicClient(APP_ID).auth.context.getProfile(id_token);\n"))),(0,o.kt)(r.Z,{value:"js",label:"JS",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'// Use jsonwebtoken plugin from NPM\nimport { decode } from "jsonwebtoken";\n\nconst authContext = decode(access_token);\nconst profile = decode(id_token);\n\n')))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("em",{parentName:"li"},"access_token")," contains the authentication information like user id, tenant id, plan etc."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("em",{parentName:"li"},"id_token")," contains user profile information.")),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Example of decoded access token"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "tid": "63d25a9e0796d40008680f96", // Tenant id\n  "scope": "TENANT_WRITE TENANT_READ USER_WRITE USER_READ AUTHENTICATED",\n  "role": "OWNER",\n  "sub": "63d25a9e0796d40008680f9a" // User id\n}\n'))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Example of decoded id token"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "John Doe",\n  "family_name": "Doe",\n  "given_name": "John",\n  "preferred_username": "john@example.com",\n  "locale": "en",\n  "email": "john@example.com",\n  "email_verified": true,\n  "onboarded": true,\n  "tenant_id": "63d25a9e0796d40008680f96",\n  "tenant_name": "Johns Family",\n  "tenant_locale": "en",\n  "tenant_logo": "",\n  "sub": "63d25a9e0796d40008680f9a" // User id\n}\n')),(0,o.kt)("p",null,"This is information you can trust since it has been cryptographically signed by Nblocks.")),(0,o.kt)("h2",{id:"testing-login"},"Testing login"),(0,o.kt)("h3",{id:"step-1-start-by-redirecting-the-user-to-the-cloud-login-url"},"Step 1. Start by redirecting the user to the cloud login url."),(0,o.kt)("p",null,"You should arrive to the cloud login screen."),(0,o.kt)("img",{src:n(7243).Z,alt:"Login screen",className:"screenshot"}),(0,o.kt)("p",null,"Enter your credentials and click login."),(0,o.kt)("admonition",{title:"Don't have an account?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If you haven't an account already you can click \"Create one\".\nNo worries, you'll remain in the login flow and get back to your app once you've verified your email address and set a password.")),(0,o.kt)("h3",{id:"step-2-complete-login"},"Step 2. Complete login"),(0,o.kt)("p",null,"Once you've logged in your're redirected back to your app with the callback code in the URL parameters.\nE.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/auth/oauth-callback?code=eyJh...."),"."))}h.isMDXComponent=!0},7243:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/login-9b456104fdbdeb9882bc56b7919f0c45.png"}}]);