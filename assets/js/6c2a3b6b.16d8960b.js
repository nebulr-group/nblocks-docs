"use strict";(self.webpackChunknblocks_docs=self.webpackChunknblocks_docs||[]).push([[2214],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),c=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=o,k=d["".concat(i,".").concat(h)]||d[h]||p[h]||r;return n?a.createElement(k,s(s({ref:t},u),{},{components:n})):a.createElement(k,s({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:o,s[1]=l;for(var c=2;c<r;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(7294),o=n(6010);const r="tabItem_Ymn6";function s(e){let{children:t,hidden:n,className:s}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(r,s),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>N});var a=n(7462),o=n(7294),r=n(6010),s=n(2466),l=n(6550),i=n(1980),c=n(7392),u=n(12);function p(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:o}}=e;return{value:t,label:n,attributes:a,default:o}}))}function d(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function k(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,i._X)(r),(0,o.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})}),[r,a])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,r=d(e),[s,l]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[i,c]=k({queryString:n,groupId:a}),[p,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,r]=(0,u.Nk)(n);return[a,(0,o.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:a}),m=(()=>{const e=i??p;return h({value:e,tabValues:r})?e:null})();(0,o.useLayoutEffect)((()=>{m&&l(m)}),[m]);return{selectedValue:s,selectValue:(0,o.useCallback)((e=>{if(!h({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),c(e),g(e)}),[c,g,r]),tabValues:r}}var m=n(2389);const f="tabList__CuJ",b="tabItem_LNqP";function y(e){let{className:t,block:n,selectedValue:l,selectValue:i,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:p}=(0,s.o5)(),d=e=>{const t=e.currentTarget,n=u.indexOf(t),a=c[n].value;a!==l&&(p(t),i(a))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=u.indexOf(e.currentTarget)+1;t=u[n]??u[0];break}case"ArrowLeft":{const n=u.indexOf(e.currentTarget)-1;t=u[n]??u[u.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t)},c.map((e=>{let{value:t,label:n,attributes:s}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>u.push(e),onKeyDown:h,onClick:d},s,{className:(0,r.Z)("tabs__item",b,s?.className,{"tabs__item--active":l===t})}),n??t)})))}function w(e){let{lazy:t,children:n,selectedValue:a}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function v(e){const t=g(e);return o.createElement("div",{className:(0,r.Z)("tabs-container",f)},o.createElement(y,(0,a.Z)({},e,t)),o.createElement(w,(0,a.Z)({},e,t)))}function N(e){const t=(0,m.Z)();return o.createElement(v,(0,a.Z)({key:String(t)},e))}},1819:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>p});var a=n(7462),o=(n(7294),n(3905)),r=n(4866),s=n(5162);const l={sidebar_position:2,sidebar_label:"Quickstart User Ready",tags:["guide","quickstart"]},i="Quickstart User Ready",c={unversionedId:"authentication-and-access/quickstart-user-ready",id:"authentication-and-access/quickstart-user-ready",title:"Quickstart User Ready",description:"On this page you will integrate your web application with Nblocks hosted login, add protection to your app and have your users authenticate to get access. We call this beeing user ready and you will accomplish this in no time.",source:"@site/docs/02-authentication-and-access/quickstart-user-ready.mdx",sourceDirName:"02-authentication-and-access",slug:"/authentication-and-access/quickstart-user-ready",permalink:"/nblocks-docs/docs/authentication-and-access/quickstart-user-ready",draft:!1,tags:[{label:"guide",permalink:"/nblocks-docs/docs/tags/guide"},{label:"quickstart",permalink:"/nblocks-docs/docs/tags/quickstart"}],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Quickstart User Ready",tags:["guide","quickstart"]},sidebar:"tutorialSidebar",previous:{title:"Switching to Nblocks",permalink:"/nblocks-docs/docs/getting-started/switching-to-nblocks"},next:{title:"Roles & Privileges",permalink:"/nblocks-docs/docs/authentication-and-access/roles-and-privileges"}},u={},p=[{value:"Nblocks login",id:"nblocks-login",level:2},{value:"Step 1: Redirect users to Nblocks login",id:"step-1-redirect-users-to-nblocks-login",level:3},{value:"Add a redirect action",id:"add-a-redirect-action",level:4},{value:"Example code",id:"example-code",level:5},{value:"Step 2: Receive the user back to your app",id:"step-2-receive-the-user-back-to-your-app",level:3},{value:"Add a callback route and use the code to exchange for user tokens",id:"add-a-callback-route-and-use-the-code-to-exchange-for-user-tokens",level:4},{value:"Example code",id:"example-code-1",level:5},{value:"Step 3: Test it",id:"step-3-test-it",level:3},{value:"1. Start your app",id:"1-start-your-app",level:4},{value:"2. Navigate to /login and get redirected to Nblocks Login",id:"2-navigate-to-login-and-get-redirected-to-nblocks-login",level:4},{value:"3. Sign up for a new account",id:"3-sign-up-for-a-new-account",level:4},{value:"4. Return to your app as a logged in user",id:"4-return-to-your-app-as-a-logged-in-user",level:4},{value:"Protect your app",id:"protect-your-app",level:2},{value:"Short info about the access token",id:"short-info-about-the-access-token",level:3},{value:"Protect your frontend",id:"protect-your-frontend",level:3},{value:"Protect a route",id:"protect-a-route",level:4},{value:"Protect your backend",id:"protect-your-backend",level:3},{value:"How will the user provide the token to the backend on each request?",id:"how-will-the-user-provide-the-token-to-the-backend-on-each-request",level:4},{value:"Protect an endpoint with role based access control",id:"protect-an-endpoint-with-role-based-access-control",level:4},{value:"User list",id:"user-list",level:2},{value:"Implement it",id:"implement-it",level:3},{value:"Example code",id:"example-code-2",level:4},{value:"Next steps",id:"next-steps",level:2}],d={toc:p};function h(e){let{components:t,...l}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"quickstart-user-ready"},"Quickstart User Ready"),(0,o.kt)("p",null,"On this page you will integrate your web application with Nblocks hosted login, add protection to your app and have your users authenticate to get access. We call this beeing user ready and you will accomplish this in no time.\nIn each step you will apply a few lines of code to make redirects using the familiar OpenId Connect / OAuth 2.0 flows, obtain user tokens, protect your app and make use of our prebuilt fully flexible user portal."),(0,o.kt)("h2",{id:"nblocks-login"},"Nblocks login"),(0,o.kt)("p",null,"The integration essentially consists of two parts where the first part is where you redirect the user's browser to Nblocks and the second one is where the user is redirected back to your app with profile information."),(0,o.kt)("p",null,"This can be implemented for multiple use cases such as if you have:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A frontend only"),(0,o.kt)("li",{parentName:"ul"},"A backend only"),(0,o.kt)("li",{parentName:"ul"},"A frontend and a backend in which case we recommend that you implement it in your backend.")),(0,o.kt)("p",null,"After you're done with this part your application will have a login flow with sign in, sign up, and SSO."),(0,o.kt)("p",null,"The Nblocks team provides, maintains, and adds code examples for popular languages continuously.\nHowever, if you have a specific need not covered by this quickstart yet, you'll find documentation on how to use Nblocks with any language in our API reference ",(0,o.kt)("a",{parentName:"p",href:"https://nebulr-group.github.io/nblocks-api-docs"},"API reference"),"."),(0,o.kt)("admonition",{title:"Prerequisites",type:"info"},(0,o.kt)("ol",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ol"},"If you haven't already, ",(0,o.kt)("a",{parentName:"li",href:"/docs/getting-started/signup"},"sign up")," for Nblocks and get access to your ",(0,o.kt)("a",{parentName:"li",href:"/docs/getting-started/id-and-keys"},"app id")," "),(0,o.kt)("li",{parentName:"ol"},"An existing web application that can run on http://localhost:8080."))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Not using http://localhost:8080?"),(0,o.kt)("p",null,"Nblocks is using sensible defaults to make development and integrations simpler.\nTo use another application address you need to change your app profile configuration."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Using ",(0,o.kt)("a",{parentName:"strong",href:"https://admin-stage.nblocks.cloud"},"Nblocks Admin"))),(0,o.kt)("p",null,"The easiest way to do so is configuring your callback URLs in the ",(0,o.kt)("a",{parentName:"p",href:"./authentication-settings#security"},"authentication settings")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Using the terminal tool")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step 1. Open ",(0,o.kt)("inlineCode",{parentName:"strong"},"app-configuration.json"),"."),(0,o.kt)("br",{parentName:"p"}),"\n","This json file was downloaded when you signed up for Nblocks through terminal."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step 2. Change the Oauth 2.0 callback uris."),(0,o.kt)("br",{parentName:"p"}),"\n","In the json file, change the defaultCallbackUri and redirectUris to the correct address for your application."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"defaultCallbackUri": "http://localhost:3000/auth/oauth-callback",\n"redirectUris": [\n    "http://localhost:3000/auth/oauth-callback"\n],\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step 3. Save the changes by pushing the updated configuration back to Nblocks")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"npx @nebulr-group/nblocks-cli push-app\n"))),(0,o.kt)("h3",{id:"step-1-redirect-users-to-nblocks-login"},"Step 1: Redirect users to Nblocks login"),(0,o.kt)("h4",{id:"add-a-redirect-action"},"Add a redirect action"),(0,o.kt)("p",null,'Open your project source code in an editor of your choice.\nThen add an action in your app that will redirect the user to the Nblocks "Login" endpoint at ',(0,o.kt)("inlineCode",{parentName:"p"},"https://auth-stage.nblocks.cloud/url/login/APP_ID")," where ",(0,o.kt)("inlineCode",{parentName:"p"},"APP_ID")," is your known app id."),(0,o.kt)("p",null,"A good practice is to add a new app route ",(0,o.kt)("inlineCode",{parentName:"p"},"/login")," that triggers this action, so that when you navigate to ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/login")," the redirect is performed."),(0,o.kt)("h5",{id:"example-code"},"Example code"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"reactjs",label:"ReactJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Create a new component that we call ",(0,o.kt)("inlineCode",{parentName:"p"},"LoginComponent"),". Routes can be created with ",(0,o.kt)("a",{parentName:"p",href:"https://reactrouter.com/"},"react-router")," plugin"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import { useEffect } from "react";\n\nexport default function LoginComponent() {\n\n  // highlight-start\n  const APP_ID = "XXX";\n  // highlight-end\n\n  useEffect(() => {\n    // Immediately redirect the web browser to Nblocks login\n    window.location.replace(`https://auth-stage.nblocks.cloud/url/login/${APP_ID}`);\n  })\n\n  return ("");\n}\n'))),(0,o.kt)(s.Z,{value:"nextjs",label:"NextJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Create a new file ",(0,o.kt)("inlineCode",{parentName:"p"},"/app/auth/login/page.jsx")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"title=/app/auth/login/page.jsx",title:"/app/auth/login/page.jsx"},"import { redirect } from 'next/navigation'\n \nexport default function Login() {\n\n  // highlight-start\n  const APP_ID = \"XXX\";\n  // highlight-end\n\n  // Immediately redirect the web browser to Nblocks login\n  redirect(`https://auth-stage.nblocks.cloud/url/login/${APP_ID}`);\n}\n"))),(0,o.kt)(s.Z,{value:"angular",label:"Angular",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Create a new component that we call ",(0,o.kt)("inlineCode",{parentName:"p"},"LoginComponent"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"@Component({\n  template: '',\n})\nexport class LoginComponent {\n  constructor(\n  ) {\n    // highlight-start\n    const APP_ID = \"XXX\";\n    // highlight-end\n\n    window.location.replace(`https://auth-stage.nblocks.cloud/url/login/${APP_ID}`);\n  }\n}\n"))),(0,o.kt)(s.Z,{value:"pseudo",label:"Can't find your stack?",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"If you cannot find your stack in the example code you need to integrate this part manually."),(0,o.kt)("p",null,"Essentially you should redirect the user to the url described in the ",(0,o.kt)("a",{parentName:"p",href:"https://nebulr-group.github.io/nblocks-api-docs/#short-hand-authorize"},"API reference")," for the ",(0,o.kt)("inlineCode",{parentName:"p"},"/url/login")," endpoint.\nYou can use the other language tabs to get an idea how this can be done."),(0,o.kt)("p",null,"Don't forget to make a request, by joining our ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/kjWYdZ6f6G"},"Discord")," and spell it out, and we'll be happy to add this stack as an example."))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Curious in what more ways you can use the  ",(0,o.kt)("inlineCode",{parentName:"p"},"/url/login")," endpoint? See the ",(0,o.kt)("a",{parentName:"p",href:"https://nebulr-group.github.io/nblocks-api-docs/#short-hand-authorize"},"API reference"))),(0,o.kt)("h3",{id:"step-2-receive-the-user-back-to-your-app"},"Step 2: Receive the user back to your app"),(0,o.kt)("p",null,"When the user completes authentication with Nblocks Login, the user is redirected back to your app with a code token that we will resolve into something more useful.\nThe URL containing the code token will look like this: ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/auth/oauth-callback?code=XXXXXX....")),(0,o.kt)("h4",{id:"add-a-callback-route-and-use-the-code-to-exchange-for-user-tokens"},"Add a callback route and use the code to exchange for user tokens"),(0,o.kt)("p",null,"Add a new route ",(0,o.kt)("inlineCode",{parentName:"p"},"/auth/oauth-callback")," in your app that will act as a handler when the user is returned. In this handler you should retrieve the code token from the URL mentioned above and save it."),(0,o.kt)("p",null,'Then we will exchange this code token it for more useful user profile information.\nYour app should make an API call to the Nblocks "Token" endpoint at ',(0,o.kt)("inlineCode",{parentName:"p"},"https://auth-stage.nblocks.cloud/token/code/APP_ID")," where ",(0,o.kt)("inlineCode",{parentName:"p"},"APP_ID")," is your known app id in order to make this exchange.\nThe returning response contains secure token data and a resolved user profile which you can print to the console or display on your frontend page."),(0,o.kt)("h5",{id:"example-code-1"},"Example code"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"reactjs",label:"ReactJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Create a new component that we call ",(0,o.kt)("inlineCode",{parentName:"p"},"CallbackComponent"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import { useEffect, useState } from "react";\nimport { useLocation } from \'react-router-dom\';\nimport { jwtVerify, createRemoteJWKSet } from "jose";\n\n// Users will get back to this component after finishing login\nexport default function CallbackComponent() {\n\n  const location = useLocation();\n  const urlSearch = new URLSearchParams(location.search);\n  const code = urlSearch.get("code");\n\n  const APP_ID = "XXX";\n\n  const [accessToken, setAccessToken] = useState();\n\n  useEffect(() => {\n    if (code) {\n      handleCallback(code);\n    }\n  }, [code]);\n\n  const handleCallback = async (code) => {\n    // Make the API call to Nblocks\n    const result = await fetch(`https://auth-stage.nblocks.cloud/token/code/${APP_ID}`,\n      {\n        method: "POST",\n        headers: {\n          "Content-Type": "application/json",\n        },\n        body: JSON.stringify({\n          code: code,\n        }),\n      }\n    ).then(res => res.json());\n\n    // Verify the result using public keys from Nblocks JWKS\n    const { access_token, refresh_token, id_token } = tokens;\n    const { payload } = await jwtVerify(\n      access_token, createRemoteJWKSet(\n          new URL(\'https://auth-stage.nblocks.cloud/.well-known/jwks.json\')\n      ), { issuer: \'https://auth-stage.nblocks.cloud\' }\n    );\n\n    // Store the result in component state and localstorage\n    setAccessToken(payload);\n    window.localStorage.setItem(\'access_token\', access_token);\n    window.localStorage.setItem(\'refresh_token\', refresh_token);\n    window.localStorage.setItem(\'id_token\', id_token);\n  };\n\n  if (accessToken)\n    return (<p>Logged in</p>);\n  else\n    return (<p>Not logged in</p>);\n}\n'))),(0,o.kt)(s.Z,{value:"nextjs",label:"NextJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Create a new page that we call ",(0,o.kt)("inlineCode",{parentName:"p"},"Callback"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"title=/app/auth/oauth-callback/page.jsx",title:"/app/auth/oauth-callback/page.jsx"},'\'use client\'\n\nimport { useSearchParams } from "next/navigation";\nimport { useEffect, useState } from "react";\n\n// Users will get back to this component after finishing login\nexport default function Callback() {\n\n  const searchParams = useSearchParams();\n\n  const APP_ID = "XXX";\n\n  const [tokens, setTokens] = useState();\n\n  useEffect(() => {\n    const code = searchParams.get(\'code\');\n    if (code) {\n      handleCallback(code);\n    }\n  }, [searchParams]);\n\n  const handleCallback = async (code) => {\n    // Make the API call to Nblocks\n    const result = await fetch(`https://auth-stage.nblocks.cloud/token/code/${APP_ID}`,\n      {\n        method: "POST",\n        headers: {\n          "Content-Type": "application/json",\n        },\n        body: JSON.stringify({\n          code: code,\n        }),\n      }\n    ).then(res => res.json());\n\n    // Store the result in component state and localstorage\n    setTokens(result);\n\n    window.localStorage.setItem(\'access_token\', result.access_token);\n  };\n\n  if (tokens)\n    return (<p>Hello {tokens.user_profile.name}</p>);\n  else\n    return (<p>Not logged in</p>);\n}\n'))),(0,o.kt)(s.Z,{value:"angular",label:"Angular",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Create a new component that we call ",(0,o.kt)("inlineCode",{parentName:"p"},"CallbackComponent"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"@Component({\n  template: '<div><p *ngIf=\"!tokens\">Not logged in</p><p *ngIf=\"tokens\">Hello {{tokens.user_profile.name}}</p></div>',\n})\n\nexport class CallbackComponent {\n\n  private APP_ID = \"XXX\";\n\n  private tokens: any;\n\n  constructor(\n    private route: ActivatedRouteSnapshot,\n    private http: HttpClient,\n  ) {\n    this.handleCallback(this.route.queryParams['code'])\n  }\n\n  private handleCallback(code: string) {\n    // Make the API call to Nblocks\n    this.http.post(`https://auth-stage.nblocks.cloud/token/code/${this.APP_ID}`, {\n      code: code\n    }).subscribe((response) => {\n      // Store the result in component state and localstorage\n      this.tokens = response;\n      window.localStorage.setItem('access_token', result.access_token);\n      window.localStorage.setItem('refresh_token', result.refresh_token);\n      window.localStorage.setItem('id_token', result.id_token);\n    });\n  }\n}\n\n"))),(0,o.kt)(s.Z,{value:"pseudo",label:"Can't find your stack?",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"If you cannot find your stack in the example code you need to integrate this part manually."),(0,o.kt)("p",null,"Essentially you should make a call to the ",(0,o.kt)("inlineCode",{parentName:"p"},"/token/code")," endpoint described in the ",(0,o.kt)("a",{parentName:"p",href:"https://nebulr-group.github.io/nblocks-api-docs/#shorthand-get-tokens"},"API reference"),"."),(0,o.kt)("p",null,"Don't forget to make a request, by joining our ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/kjWYdZ6f6G"},"Discord")," and spell it out, and we'll be happy to add this stack as an example."))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Token Response example"),(0,o.kt)("br",{parentName:"p"}),"\n","This is shows the structure of the token response."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "token_type": "Bearer",\n  "expires_in": 3600,\n  "access_token": "eyJhbGciOiJQ...",\n  "refresh_token": "eyJhbGciOiJQ...",\n  "id_token": "eyJhbGciOiJQ...",\n  "user_profile": {\n    "name": "John Doe",\n    "family_name": "Doe",\n    "given_name": "John",\n    ...\n  }\n}\n')),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Curious in what more ways you can use the  ",(0,o.kt)("inlineCode",{parentName:"p"},"/token/code")," endpoint? See the ",(0,o.kt)("a",{parentName:"p",href:"https://nebulr-group.github.io/nblocks-api-docs/#shorthand-get-tokens"},"API reference"))),(0,o.kt)("h3",{id:"step-3-test-it"},"Step 3: Test it"),(0,o.kt)("h4",{id:"1-start-your-app"},"1. Start your app"),(0,o.kt)("p",null,"Start your application so that it is accessible on ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:8080"},"http://localhost:8080")),(0,o.kt)("h4",{id:"2-navigate-to-login-and-get-redirected-to-nblocks-login"},"2. Navigate to /login and get redirected to Nblocks Login"),(0,o.kt)("p",null,"Navigate to ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:8080/login"},"http://localhost:8080/login"),". Your code redirects the user to Nblocks Login.\n",(0,o.kt)("img",{alt:"Nblocks Login",src:n(158).Z,width:"3456",height:"2161"})),(0,o.kt)("h4",{id:"3-sign-up-for-a-new-account"},"3. Sign up for a new account"),(0,o.kt)("p",null,"Since you don't have a previous user account click \"",(0,o.kt)("strong",{parentName:"p"},"Sign up"),'".'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Nblocks Sign up",src:n(7319).Z,width:"3456",height:"2159"})),(0,o.kt)("p",null,"You can sign up with your email or use Google or Microsoft SSO for a faster process. These SSO's are available as Demo integrations from Nblocks from start."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Nblocks Google SSO",src:n(7918).Z,width:"3456",height:"2159"})),(0,o.kt)("p",null,"Here we have clicked to sign up with Google. The Google login screen is shown."),(0,o.kt)("h4",{id:"4-return-to-your-app-as-a-logged-in-user"},"4. Return to your app as a logged in user"),(0,o.kt)("p",null,"After logging in, you get redirected back to your application again and we see the name of the logged in user.\n",(0,o.kt)("img",{alt:"Callback",src:n(1173).Z,width:"3456",height:"2159"})),(0,o.kt)("admonition",{title:"Didn't the callback work?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Make sure your application is running on port 8080. That is the most common misstake.\nIf not, check the prerequisites section again to learn how to use another port than 8080.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"That's all!")," You've completed integrating with Nblock Login. Next step is to add protection to your app so that only logged in users can access its content."),(0,o.kt)("h2",{id:"protect-your-app"},"Protect your app"),(0,o.kt)("p",null,"Securing your app when you have logged in users is crucial. Here's some examples that points out why this is important."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"You only want logged in users to access the app, otherwise they should be prompted with a login."),(0,o.kt)("li",{parentName:"ul"},"You have frontend views, components or backend endpoints that only some users should be able to access. E.g. an analytics view for only users with the privilege ",(0,o.kt)("inlineCode",{parentName:"li"},"ANALYTICS_READ"),".")),(0,o.kt)("p",null,"Below we'll show how easily you can add protection to your app by using the tokens obtained from the logged in user."),(0,o.kt)("h3",{id:"short-info-about-the-access-token"},"Short info about the access token"),(0,o.kt)("p",null,"When you completed the Nblocks login part of this quickstart you got hold of a couple of tokens that was signed securely by Nblocks.\nOne of them, the access token holds the users access information and this information can be used to protect your app.\nThe token is encoded in a format called ",(0,o.kt)("a",{parentName:"p",href:"https://jwt.io"},"JWT")," for greater portability and security. If we decode the access token it looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'\n{\n    "aid": "63d2ab029e23db0afb07a5a7",\n    "tid": "63d2b5c18892e10022e08399",\n    // highlight-start\n    "scope": "AUTHENTICATED USER_READ USER_WRITE TENANT_READ TENANT_WRITE",\n    "role": "OWNER",\n    // highlight-end\n    "plan": "FREE",\n    "iat": 1685648418,\n    "exp": 1685652018,\n    "aud": [\n        "63d2ab029e23db0afb07a5a7",\n        "https://app-stage.nblocks.cloud"\n    ],\n    "iss": "https://auth-stage.nblocks.cloud",\n    "sub": "63d2b5c18892e10022e083a2"\n}\n\n')),(0,o.kt)("admonition",{title:"Decoding and verifying JWTs",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"JWTs is a well known concept in security. That means there are plenty of libraries for many software stacks to decode and verify them into readable JSON. Here's a extensive ",(0,o.kt)("a",{parentName:"p",href:"https://jwt.io/libraries"},"list")," of different libraries.\nWe'll be using one of these in our code examples.")),(0,o.kt)("p",null,"In the structure above, we highlighted the parts that we'll be focusing on in this part of the guide."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"role")," property indicates the role of the user."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"scope")," property specifies the privileges the user obtains when logging in with that role. This can be used for more fine-grained protection and role-based access control on individual features."),(0,o.kt)("li",{parentName:"ul"},"You can ",(0,o.kt)("a",{parentName:"li",href:"./roles-and-privileges"},"configure the roles and privileges")," to your specific needs.")),(0,o.kt)("h3",{id:"protect-your-frontend"},"Protect your frontend"),(0,o.kt)("admonition",{title:"Don't have a frontend?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You can skip this part if you don't have a frontend.")),(0,o.kt)("p",null,"In this part we'll be showing you how easy it is to secure your application frontend with Nblocks.\nYou'll ",(0,o.kt)("strong",{parentName:"p"},"Protect a route"),", that only some users can access and others will be redirected back."),(0,o.kt)("p",null,"After you're done with this part your application frontend will be able to show/hide content depending on what user login."),(0,o.kt)("h4",{id:"protect-a-route"},"Protect a route"),(0,o.kt)("p",null,"Protecting a whole route is as simple as protecting part of the web page.\nBut instead of hiding/showing content we can redirect the user to another page if the requirements are not met."),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"reactjs",label:"ReactJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Imaging you have a React router structure like this."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'<BrowserRouter>\n    <Routes>\n        <Route path="/auth/login" element={<LoginComponent />} />\n        <Route path="/auth/oauth-callback" element={<CallbackComponent />} />\n        <Route path="/home" element={<HomeComponent />} />\n        <Route path="/analytics" element={<AnalyticsComponent />} />\n    </Routes>\n</BrowserRouter>\n\n')),(0,o.kt)("p",null,"We want to protect all routes for only logged in users, otherwise they should be redirected back to Login again. Therefore we need to use the access token to protect this route conditionally.\nThis can easily be done likt this: "),(0,o.kt)("p",null,"Create a new component that we call ",(0,o.kt)("inlineCode",{parentName:"p"},"ProtectedRoute"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import { useEffect, useState } from "react";\nimport { decodeJwt } from "jose";\nimport { Navigate } from \'react-router-dom\';\n\nexport default function ProtectedRoute({roles, privileges, redirectTo, children}) {\n\n  // This will be our variable telling if the user is granted access or if we should redirect to login\n  // Initially this variable is true since we don\'t want to redirect before resolving the \n  const [granted, setGranted] = useState(true);\n  \n  // This is the path which users without access should be redirect to\n  const redirectPath = redirectTo ? redirectTo : "/auth/login";\n\n  useEffect(() => {\n    // Retrieve the access token JWT from localstorage\n    const accessToken = window.localStorage.getItem(\'access_token\');\n    if (accessToken) {\n      const decoded = decodeJwt(accessToken);\n      setGranted(hasRoleOrPrivilege(decoded));\n    } else {\n      setGranted(false);\n    }\n  }, []);\n\n  // Helper method to see if the users token contains any of the required roles or privileges \n  const hasRoleOrPrivilege = (decoded) => {\n    return roles ? roles.includes(decoded.role) : false || privileges ? privileges.some(scope => decoded.scope.includes(scope)) : false;\n  }\n\n  // Only if granted should we render the component children\n  if (granted)\n    return (children);\n  else\n    return (<Navigate to={redirectPath} replace />);\n}\n\n')),(0,o.kt)("p",null,"Now you can use this component in your app routing like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'<BrowserRouter>\n    <Routes>\n        <Route path="/auth/login" element={<LoginComponent />} />\n        <Route path="/auth/oauth-callback" element={<CallbackComponent />} />\n        // highlight-start\n        <Route path="*" element={\n            <ProtectedRoute privileges={["AUTHENTICATED"]}>\n              <Routes>\n              // highlight-end\n                <Route path="/home" element={<HomeComponent />} />\n                <Route path="/analytics" element={<AnalyticsComponent />} />\n                // highlight-start\n              </Routes>\n            </ProtectedRoute>\n          }\n        />\n        // highlight-end\n    </Routes>\n</BrowserRouter>\n\n')),(0,o.kt)("p",null,"If you now try to navigate to either ",(0,o.kt)("inlineCode",{parentName:"p"},"/home")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"/analytics")," without being logged in, you will be redirected to login."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"More examples"),(0,o.kt)("p",null,"Our ProtectedRoute can do more like redirecting to a forbidden page if the user is logged in but are missing a required privilege.  Here's how that would look:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'<BrowserRouter>\n    <Routes>\n        <Route path="/auth/login" element={<LoginComponent />} />\n        <Route path="/auth/oauth-callback" element={<CallbackComponent />} />\n        <Route path="/forbidden" element={<ForbiddenComponent />} />\n        <Route path="*" element={\n            <ProtectedRoute privileges={["AUTHENTICATED"]}>\n              <Routes>\n                <Route path="/home" element={<HomeComponent />} />\n                <Route path="/analytics" element={\n                    <ProtectedRoute\n                      privileges={["ANALYTICS"]}\n                      redirectTo="/forbidden"\n                    >\n                      <AnalyticsComponent />\n                    </ProtectedRoute>\n                  }\n                />\n              </Routes>\n            </ProtectedRoute>\n          }\n        />\n    </Routes>\n</BrowserRouter>\n')))),(0,o.kt)(s.Z,{value:"nextjs",label:"NextJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Imaging you have a NextJS page component that renders analytics data looking like this."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/app/analytics/page.jsx"',title:'"/app/analytics/page.jsx"'},"'use client'\n\nconst AnalyticsPage = () => {\n    return (\n      <div>\n        <h1>Analytics</h1>\n        <DetailsGraph />\n        <RevenueTable />\n      </div>\n    )\n}\n\nexport default AnalyticsPage;\n")),(0,o.kt)("p",null,"We want to protect this page for only logged in users, otherwise they should be redirected back to Login again.\nTherefore we need to use the access token to protect this route conditionally.\nThis can easily be done likt this:"),(0,o.kt)("p",null,"Create a new component ",(0,o.kt)("inlineCode",{parentName:"p"},"/components/protected-route.jsx")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/components/protected-route.jsx"',title:'"/components/protected-route.jsx"'},'"use client";\n\nimport React, { useEffect, useState } from "react";\nimport { useRouter } from "next/navigation";\nimport { decodeJwt } from "jose";\n\nfunction ProtectedRoute<T>(\n  Component: React.ComponentType<T>,\n  args: { roles, privileges, redirectTo }\n) {\n  return (props: T) => {\n    // This is the path which users without access should be redirect to\n    const redirectTo = args.redirectTo || "/auth/login";\n    const { roles, privileges } = args;\n    const router = useRouter();\n\n    const [granted, setGranted] = useState(false);\n\n    useEffect(() => {\n      // Retrieve the access token JWT from localstorage\n      const accessToken = window.localStorage.getItem("access_token");\n      if (accessToken) {\n        const decoded = decodeJwt(accessToken);\n        if (hasRoleOrPrivilege(decoded)) {\n          setGranted(true);\n        } else {\n          router.push(redirectTo);\n        }\n      } else {\n        router.push(redirectTo);\n      }\n    }, []);\n\n    // Helper method to see if the users token contains any of the required roles or privileges \n    const hasRoleOrPrivilege = (decoded: any) => {\n      return roles ? roles.includes(decoded.role) : false || privileges ? privileges.some((scope) => decoded.scope.includes(scope)) : false;\n    };\n\n    // Only if granted should we render component\n    if (granted)\n      return (\n        <>\n          <Component {...props!} />\n        </>\n      );\n  };\n}\n\nexport default ProtectedRoute;\n')),(0,o.kt)("p",null,"Now you can use this ProtectedRoute component to secure the AnalyticsPage like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/app/analytics/page.jsx"',title:'"/app/analytics/page.jsx"'},'\'use client\'\n\n// highlight-start\nimport IsAuth from "@/components/protected-route";\n// highlight-end\n\nconst AnalyticsPage = () => {\n    return (\n      <div>\n        <h1>Analytics</h1>\n        <DetailsGraph />\n        <RevenueTable />\n      </div>\n    )\n}\n// highlight-start\nexport default ProtectedRoute(AnalyticsPage, {privileges: ["AUTHENTICATED"]);\n// highlight-end\n')),(0,o.kt)("p",null,"If you now try to navigate to ",(0,o.kt)("inlineCode",{parentName:"p"},"/analytics")," without being logged in, you will be redirected to login."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"More examples"),(0,o.kt)("p",null,"Our ProtectedRoute can do more like redirecting to a forbidden page if the user is logged in but are missing a required privilege. Here's how that would look:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'\nexport default ProtectedRoute(AnalyticsPage, {privileges: ["ANALYTICS"], redirectTo="/forbidden");\n\nexport default ProtectedRoute(AnalyticsPage, {roles: ["ADMIN"]);\n')))),(0,o.kt)(s.Z,{value:"pseudo",label:"Can't find your stack?",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"If you cannot find your stack in the example code you need to integrate this part manually."),(0,o.kt)("p",null,"You can use the other language tabs to get an idea how this can be done."),(0,o.kt)("p",null,"Don't forget to make a request, by joining our ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/kjWYdZ6f6G"},"Discord")," and spell it out, and we'll be happy to add this stack as an example."))),(0,o.kt)("h3",{id:"protect-your-backend"},"Protect your backend"),(0,o.kt)("admonition",{title:"Don't have a backend?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You can skip this part if you don't have a backend.")),(0,o.kt)("p",null,"Securing your backend is even more important than securing your frontend since the backend usually holds sensitive and important information that we never want to return to a user that is either not logged in or not the rightful recipient of that information."),(0,o.kt)("p",null,"In this part we'll be showing you how easy it is to secure your application backend with Nblocks. You will ",(0,o.kt)("strong",{parentName:"p"},"protect an endpoint with role based access control"),", so that only users with the right privilege can query it."),(0,o.kt)("p",null,"After you're done with this part you will have an application backend that is secure and ready for production."),(0,o.kt)("h4",{id:"how-will-the-user-provide-the-token-to-the-backend-on-each-request"},"How will the user provide the token to the backend on each request?"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If your developing an application with both a backend and a frontend it is best practise to let the frontend attach the access token as an ",(0,o.kt)("inlineCode",{parentName:"li"},"authorization")," header on each request to the backend."),(0,o.kt)("li",{parentName:"ul"},"When developing a backend only application you could either still resort to clients providing the ",(0,o.kt)("inlineCode",{parentName:"li"},"authorization")," header in each request or store the accessToken in a session cookie once you obtained it in the Nblocks Login part of this quickstart. Clients will provide this cookie automatically on every future request.")),(0,o.kt)("h4",{id:"protect-an-endpoint-with-role-based-access-control"},"Protect an endpoint with role based access control"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"expressjs",label:"ExpressJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Imagine you have declared two endpoints, ",(0,o.kt)("inlineCode",{parentName:"p"},"/dashboardData")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"/analyticsData")," in your express app like this."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const app = express();\n\napp.get('/dashboardData', (req, res) => {\n  ...\n});\n\napp.get('/analyticsData', (req, res) => {\n  ...\n});\n\napp.listen(port, () => {\n  console.log(`Example app listening at http://localhost:${port}`);\n});\n")),(0,o.kt)("p",null,"We want both of the endpoints to require the user to be logged in before rendering a result.\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"/analyticsData")," endpoint should only be accessable for users with the privilege ",(0,o.kt)("inlineCode",{parentName:"p"},"ANALYTICS_READ"),".\nAll this can easily be done with Express middlewares:"),(0,o.kt)("p",null,"Create a new file in which we declare two middlewares."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { jwtVerify, createRemoteJWKSet } from 'jose';\n\n// Verifies and decodes the access token from the authorization header\nconst jwtMiddleware = async (req, res, next) => {\n  if (req.headers['authorization']) {\n    try {\n      // Get the public key to verify the token signed by Nblocks\n      const JWKS = createRemoteJWKSet(\n        new URL('https://auth-stage.nblocks.cloud/.well-known/jwks.json')\n      );\n\n      // Deconstruct user from the verified token and store the decoded information in a variable that can be used by other middlewares\n      const { payload: user } = await jwtVerify(\n        req.headers['authorization'], JWKS, { issuer: 'https://auth-stage.nblocks.cloud' }\n      );\n      req.user = user;\n      next();\n    } catch (e) {\n      next(e);\n    }\n  }\n};\n\n// Grants or denies access based on the decoded token from jwtMiddleware\nconst protectedRoute = ({ roles, privileges }) => {\n  return (req, res, next) => {\n    if (req.user) {\n      if (\n        roles\n          ? roles.includes(req.user.role)\n          : false || privileges\n          ? privileges.some((scope) => req.user.scope.includes(scope))\n          : false\n      ) {\n        next();\n      } else {\n        res.status(403).send({ message: 'Forbidden' });\n      }\n    } else {\n      res.status(401).send({ message: 'Unauthorized' });\n    }\n  };\n};\n\nexport { jwtMiddleware, protectedRoute }\n")),(0,o.kt)("admonition",{title:"Handling users not logged in",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If you're building a backend only app, you might want to redirect users to ",(0,o.kt)("inlineCode",{parentName:"p"},"/auth/login")," instead of rendering a ",(0,o.kt)("inlineCode",{parentName:"p"},"401 Unauthorized")," error in case they're unauthorized for a better user experience.")),(0,o.kt)("p",null,"Heading back to the initial express app file we can now make use of these middleware to start protecting the endpoints!"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// highlight-start\nimport { jwtMiddleware, protectedRoute } from './middlewares'\n// highlight-end\n\nconst app = express();\n\n// highlight-start\n// First middleware that decodes tokens\napp.use(jwtMiddleware);\n\n// Restrict all endpoints globally with protectedRoute to require authenticated users\napp.use(protectedRoute({privileges: ['AUTHENTICATED']}));\n// highlight-end\n\napp.get('/dashboardData', (req, res) => {\n  ...\n});\n\n// highlight-start\n// Restrict /analyticsData with protectedRoute to require users with ANALYTICS_READ privilege\napp.get('/analyticsData', protectedRoute({privileges: ['ANALYTICS_READ']}), (req, res) => {\n// highlight-end\n  ...\n});\n\napp.listen(port, () => {\n  console.log(`Example app listening at http://localhost:${port}`);\n});\n")),(0,o.kt)("details",null,(0,o.kt)("summary",null,"More examples"),(0,o.kt)("p",null,"Our ",(0,o.kt)("inlineCode",{parentName:"p"},"protectedRoute")," middleware can be activated in other ways, like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// Protect all endpoints\napp.use(protectedRoute({privileges: ['AUTHENTICATED']}));\n\n// Protect /analyticsData\napp.use(\"/analyticsData\", protectedRoute({privileges: ['AUTHENTICATED']}));\n\n// Protect using wildcards\napp.use(\"/secret/*\", protectedRoute({roles: ['ADMIN']}));\n\n")))),(0,o.kt)(s.Z,{value:"pseudo",label:"Can't find your stack?",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"If you cannot find your stack in the example code you need to integrate this part manually."),(0,o.kt)("p",null,"You can use the other language tabs to get an idea how this can be done."),(0,o.kt)("p",null,"Don't forget to make a request, by joining our ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/kjWYdZ6f6G"},"Discord")," and spell it out, and we'll be happy to add this stack as an example."))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"That's all!")," With this part we've show the best practises how you can protect your backend application using the tokens generated from Nblocks Login. Next up is how we can let the logged in users invite others."),(0,o.kt)("h2",{id:"user-list"},"User list"),(0,o.kt)("p",null,"In the last last part of the quickstart we're adding a user management view to let the users manage and invite others to their tenant."),(0,o.kt)("p",null,"You can embedd this view straight into your app either by using Iframes or redirecting the user to it. It looks like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"User list",src:n(2929).Z,width:"3456",height:"2160"})),(0,o.kt)("h3",{id:"implement-it"},"Implement it"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The url can either be rendered as an Iframe or you can redirect the user to it.")),(0,o.kt)("p",null,"There will be two Nblocks endpoints involved when requesting to render the user list."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"First we need to get the ",(0,o.kt)("a",{parentName:"li",href:"https://nebulr-group.github.io/nblocks-api-docs/#handover-code"},"handover code")," which is unique to the user. This is done using ",(0,o.kt)("inlineCode",{parentName:"li"},"/handover/code")," endpoint."),(0,o.kt)("li",{parentName:"ol"},"Then we will use the code to render the ",(0,o.kt)("a",{parentName:"li",href:"https://nebulr-group.github.io/nblocks-api-docs/#user-management-portal-users"},"user list view")," using the ",(0,o.kt)("inlineCode",{parentName:"li"},"/user-management-portal/users")," endpoint.")),(0,o.kt)("h4",{id:"example-code-2"},"Example code"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"reactjs",label:"ReactJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Create a new component that we call ",(0,o.kt)("inlineCode",{parentName:"p"},"UserList"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import { useEffect, useState } from "react";\n\nexport default function UserList() {\n  const [url, setUrl] = useState();\n\n  const APP_ID = "XXX";\n\n  useEffect(() => {\n    createUrl();\n  }, []);\n\n    const createUrl = async () => {\n    // Retrieve the access token JWT from localstorage\n    const accessToken = window.localStorage.getItem("access_token");\n\n    // Get the handover code from Nblocks\n    const result = await fetch(\n      `https://auth-stage.nblocks.cloud/handover/code/${APP_ID}`,\n      {\n        method: "POST",\n        headers: {\n          "Content-Type": "application/json",\n        },\n        body: JSON.stringify({\n          accessToken,\n        }),\n      }\n    ).then((res) => res.json());\n\n    // Create the user management portal url\n    setUrl(\n      `https://backendless-stage.nblocks.cloud/user-management-portal/users?code=${result.code}`\n    );\n  };\n\n  // Render the url as an iframe\n  return <iframe width="100%" height="500px" src={url}></iframe>;\n}\n\n')),(0,o.kt)("p",null,"Now you can render the ",(0,o.kt)("inlineCode",{parentName:"p"},"UserList")," component anywhere you want to have the user access it.")),(0,o.kt)(s.Z,{value:"nextjs",label:"NextJS",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"Create a new file at ",(0,o.kt)("inlineCode",{parentName:"p"},"app/users/page.jsx")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'\'use client\'\n\nimport { useState, useEffect } from "react";\n\nexport default function UserList() {\n  const APP_ID = "XXX";\n\nconst [url, setUrl] = useState();\n\n  useEffect(() => {\n    createUrl();\n  }, []);\n\n    const createUrl = async () => {\n    // Retrieve the access token JWT from localstorage\n    const accessToken = window.localStorage.getItem("access_token");\n\n    // Get the handover code from Nblocks\n    const result = await fetch(\n      `https://auth-stage.nblocks.cloud/handover/code/${APP_ID}`,\n      {\n        method: "POST",\n        headers: {\n          "Content-Type": "application/json",\n        },\n        body: JSON.stringify({\n          accessToken,\n        }),\n      }\n    ).then((res) => res.json());\n\n    // Create the user management portal url\n    setUrl(\n      `https://backendless-stage.nblocks.cloud/user-management-portal/users?code=${result.code}`\n    );\n  };\n\n  // Render the url as an iframe\n  return <iframe width="100%" height="500px" src={url}></iframe>;\n}\n\n')),(0,o.kt)("p",null,"Now you can navigate to ",(0,o.kt)("inlineCode",{parentName:"p"},"/users")," and see the user list render.")),(0,o.kt)(s.Z,{value:"pseudo",label:"Can't find your stack?",default:!0,mdxType:"TabItem"},(0,o.kt)("p",null,"If you cannot find your stack in the example code you need to integrate this part manually."),(0,o.kt)("p",null,"You can use the other language tabs to get an idea how this can be done."),(0,o.kt)("p",null,"Don't forget to make a request, by joining our ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/kjWYdZ6f6G"},"Discord")," and spell it out, and we'll be happy to add this stack as an example."))),(0,o.kt)("admonition",{title:"How to get the access token?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"In the User Login Quickstart, we stored the access token into Localstorage as a fast and easy way later retrieve it again. Other ways could be to save in-memory in a global state or React context.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Now your done!"),(0,o.kt)("br",{parentName:"p"}),"\n","That was the last step of the quickstart and we've covered the three things that has made your app user ready."),(0,o.kt)("h2",{id:"next-steps"},"Next steps"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Add SSO alternatives to your login experience, replacing the Demo integrations.")),(0,o.kt)("p",null,"If you haven't already, join our ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/kjWYdZ6f6G"},"Discord")))}h.isMDXComponent=!0},1173:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/callback-screen-0de2b007d25a88a3f2bb59da111f90ac.png"},7918:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/google-screen-7122b101abf02b48b1eb49183af6ebe9.png"},158:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/login-screen-8e1ca7623214fa765ddf83956e1a5eb7.png"},7319:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/signup-screen-79bb061efeb9d1ee9f93e793ab5db9f9.png"},2929:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/user-list-ef17ce9954b934322cb96ed378f050ee.png"}}]);